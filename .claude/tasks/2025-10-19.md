# Tâches ComboTrack - 19 Octobre 2025

## Contexte d'analysis

Après analysis approfondie du codebase, voici l'état actuel du projet :

**Fonctionnalités existantes :**
- Authentification avec Better-Auth (email/password)
- Modèle de données complet (User, Match, Note) avec ULID
- Lecteur vidéo YouTube intégré avec hooks personnalisés
- Formulaire de création de notes avec validation Zod
- Server action pour créer des notes (`createNoteAction`)
- Routing dynamique pour les vidéos (`/videos/[id]`)

**Lacunes identifiées :**
- NoteList non implémentée (src/components/features/video/note-list.tsx:14)
- Pas de navigation temporelle vers les timestamps
- Aucune action CRUD pour les matches (seulement lecture)
- Pas de page d'accueil pour lister tous les matches
- Pas de fonctionnalité d'édition/suppression de notes

---

## Tâche 1 : Compléter l'implémentation de NoteList avec navigation temporelle

**Priorité :** CRITIQUE
**Localisation :** `src/components/features/video/note-list.tsx`

**Objectif :**
Transformer le composant NoteList en une liste fonctionnelle et interactive qui permette :
1. D'afficher toutes les notes d'un match avec leur timestamp formaté (MM:SS)
2. De naviguer dans la vidéo en cliquant sur une note
3. D'offrir une UX fluide avec des composants shadcn/ui (Card, Badge)

**Technical analysis:**
- Le composant reçoit déjà `notes: Note[]` en props
- Il doit recevoir en plus une fonction `seekToTimestamp(seconds: number)` depuis VideoPlayer
- Utiliser les composants shadcn existants : Card pour chaque note, Badge pour le timestamp
- Formatter le timestamp avec une fonction utilitaire `formatTimestamp(seconds: number): string`

**Implémentation requise :**
```typescript
// Ajouter une prop seekToTimestamp dans NoteListProps
// Créer une fonction formatTimestamp dans src/utils/
// Mapper les notes avec Card + Badge + bouton de lecture
// Trier les notes par timestamp croissant
```

**Dépendances :**
- VideoPlayer doit exposer une méthode seekTo() via playerRef
- Créer un utilitaire de formatage de temps

---

## Tâche 2 : Ajouter les actions CRUD pour les notes (Update & Delete)

**Priorité :** HAUTE
**Localisation :** `src/components/features/video/note-action.ts`

**Objectif :**
Compléter le cycle de vie des notes en ajoutant les server actions manquantes :
- `updateNoteAction` : modifier le contenu d'une note existante
- `deleteNoteAction` : supprimer une note

**Technical analysis:**
- Suivre le pattern existant avec `actionClient` et validation Zod
- updateNoteAction nécessite : `noteId`, `content`, `timestamp` (optionnel)
- deleteNoteAction nécessite seulement : `noteId`
- Ajouter une vérification de propriété (userId) pour la sécurité
- Gérer les erreurs (note inexistante, permissions)

**Implémentation requise :**
```typescript
export const updateNoteAction = actionClient
  .inputSchema(z.object({
    noteId: z.string(),
    content: z.string().min(2),
    timestamp: z.number().min(0).optional()
  }))
  .action(async ({ parsedInput }) => {
    // Vérifier que la note existe et appartient à l'utilisateur
    // Mettre à jour avec prisma.note.update()
  });

export const deleteNoteAction = actionClient
  .inputSchema(z.object({ noteId: z.string() }))
  .action(async ({ parsedInput }) => {
    // Vérifier permissions puis prisma.note.delete()
  });
```

**UI associée :**
- Ajouter des boutons Edit/Delete dans NoteList
- Dialog de confirmation pour la suppression
- Formulaire inline ou modal pour l'édition

---

## Tâche 3 : Créer la page d'accueil avec liste des matches

**Priorité :** HAUTE
**Localisation :** `app/videos/page.tsx` (à enrichir) + nouveaux composants

**Objectif :**
Transformer la page `/videos` en dashboard fonctionnel permettant de :
- Lister tous les matches de l'utilisateur connecté
- Afficher une preview de chaque match (thumbnail YouTube, titre, date)
- Permettre la navigation vers chaque match
- Ajouter un bouton "Nouveau match" pour créer des matches

**Technical analysis:**
- Récupérer les matches avec `prisma.match.findMany({ where: { userId } })`
- Créer un composant `MatchCard` dans `src/components/features/match/`
- Utiliser le Grid layout de shadcn pour l'affichage
- Extraire le thumbnail YouTube depuis l'URL : `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`

**Structure de composants :**
```
src/components/features/match/
  ├── match-card.tsx (affichage d'un match avec thumbnail)
  ├── match-list.tsx (grille de MatchCard)
  └── create-match-button.tsx (bouton + dialog/modal)
```

**Dépendances :**
- Session utilisateur (Better-Auth) pour filtrer par userId
- Utilitaire extractYoutubeVideoId déjà existant

---

## Tâche 4 : Implémenter la création de matches avec validation

**Priorité :** HAUTE
**Localisation :** Nouveaux fichiers dans `src/components/features/match/`

**Objectif :**
Permettre aux utilisateurs de créer des nouveaux matches pour analyser des vidéos YouTube.

**Technical analysis:**
- Créer un server action `createMatchAction` dans `src/components/features/match/match-action.ts`
- Schema Zod : `{ title: string, videoUrl: string (URL YouTube valide) }`
- Validation de l'URL YouTube avec extractYoutubeVideoId
- Associer automatiquement le match au userId de la session
- Rediriger vers `/videos/[id]` après création

**Implémentation requise :**
```typescript
// match-action.ts
export const createMatchAction = actionClient
  .inputSchema(z.object({
    title: z.string().min(3, "Title must be at least 3 characters"),
    videoUrl: z.string().url().refine(
      (url) => extractYoutubeVideoId(url) !== null,
      { message: "Must be a valid YouTube URL" }
    )
  }))
  .action(async ({ parsedInput }) => {
    // Récupérer userId depuis session
    // Créer le match avec prisma.match.create()
    // Retourner l'id pour redirection
  });
```

**Composants UI :**
- CreateMatchDialog avec formulaire react-hook-form
- Validation en temps réel de l'URL YouTube
- Loading state pendant la création

---

## Tâche 5 : Ajouter une barre de navigation globale avec breadcrumbs

**Priorité :** MOYENNE
**Localisation :** `src/components/layout/` + modification de Layout

**Objectif :**
Améliorer l'UX de navigation en ajoutant :
- Une navbar avec logo ComboTrack + user menu (logout)
- Des breadcrumbs dynamiques : Home > Videos > [Match Title]
- Un lien rapide "Mes matchs" vers `/videos`

**Technical analysis:**
- Utiliser le composant Breadcrumb de shadcn (déjà installé)
- Créer un Navbar.tsx dans src/components/layout/
- Intégrer Better-Auth pour afficher l'email user et le bouton logout
- Les breadcrumbs doivent être dynamiques selon la route

**Structure proposée :**
```typescript
// src/components/layout/navbar.tsx
export function Navbar() {
  const { data: session } = useSession(); // Better-Auth hook
  return (
    <nav className="border-b">
      <div className="container flex items-center justify-between">
        <Link href="/">ComboTrack</Link>
        <div className="flex items-center gap-4">
          <Link href="/videos">Mes matchs</Link>
          <DropdownMenu>
            <DropdownMenuTrigger>{session?.user?.email}</DropdownMenuTrigger>
            <DropdownMenuContent>
              <DropdownMenuItem onClick={signOut}>Logout</DropdownMenuItem>
            </DropdownMenuContent>
          </DropdownMenu>
        </div>
      </div>
    </nav>
  );
}
```

**Intégration dans Layout :**
- Modifier `src/components/layout/Layout.tsx` pour inclure Navbar
- Ajouter les breadcrumbs dans LayoutHeader selon le contexte

---

## Prochaines étapes après ces 5 tâches

Une fois ces tâches complétées, le MVP sera fonctionnel avec :
- ✅ Création, lecture, modification, suppression de notes
- ✅ Gestion complète des matches
- ✅ Navigation fluide avec breadcrumbs
- ✅ Liste interactive de notes avec navigation temporelle

**Futures améliorations à envisager :**
- Filtres et recherche dans les matches
- Tags pour catégoriser les notes (neutral, combo, punish, etc.)
- Export des notes en PDF/Markdown
- Partage de matches entre utilisateurs
- Analytics (notes par match, timestamps les plus annotés)
